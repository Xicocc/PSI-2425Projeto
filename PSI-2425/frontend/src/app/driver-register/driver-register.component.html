<mat-card>
    <mat-card-title>Registar Condutor</mat-card-title>
    <mat-card-content>
      <form #form="ngForm" (ngSubmit)="onSubmit(form)" class="driver-form">
        <!-- Personal Information Section -->
        <h3 class="section-title">Informação Pessoal</h3>
        
        <!-- Name -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nome Completo</mat-label>
          <input matInput name="name" ngModel required maxlength="100">
        </mat-form-field>
  
        <!-- NIF -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>NIF</mat-label>
          <input matInput name="nif" ngModel required 
                 pattern="[0-9]{9}" minlength="9" maxlength="9"
                 placeholder="9 dígitos">
          <mat-hint>Deve conter exatamente 9 dígitos</mat-hint>
        </mat-form-field>
  
        <!-- Gender -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Género</mat-label>
          <mat-select name="gender" ngModel required>
            <mat-option *ngFor="let gender of genders" [value]="gender">{{ gender }}</mat-option>
          </mat-select>
        </mat-form-field>
  
        <!-- Birth Year -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Ano de Nascimento</mat-label>
          <input matInput type="number" name="birthYear" ngModel required
                 [min]="minBirthYear" [max]="maxBirthYear">
          <mat-hint>Idade mínima: 18 anos</mat-hint>
        </mat-form-field>
  
        <!-- Address Section -->
      <h3 class="section-title">Morada</h3>
      
      <!-- Postal Code -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Código Postal</mat-label>
        <input matInput name="postalCode" [(ngModel)]="driverData.address.postalCode" required 
               pattern="[0-9]{4}-[0-9]{3}" 
               (input)="formatPostalCode($event)"
               placeholder="0000-000">
        <mat-hint>Insira o código postal para buscar a morada</mat-hint>
      </mat-form-field>

      <!-- Address Suggestions -->
      <div *ngIf="addressSuggestions.length > 0 && !manualAddressInput" class="suggestions-container">
        <mat-radio-group>
          <mat-radio-button *ngFor="let address of addressSuggestions" 
                           [value]="address" 
                           (click)="selectAddress(address)">
            {{ address.address }}, {{ address.city }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- Manual Input Toggle -->
      <mat-checkbox (change)="toggleManualInput()" class="manual-toggle">
        {{ manualAddressInput ? 'Usar busca automática' : 'Inserir morada manualmente' }}
      </mat-checkbox>

      <!-- Street (shown always but conditionally required) -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Rua</mat-label>
        <input matInput name="street" [(ngModel)]="driverData.address.street" 
               [required]="manualAddressInput || addressSuggestions.length === 0" 
               maxlength="200">
      </mat-form-field>

      <!-- City (shown always but conditionally required) -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Localidade</mat-label>
        <input matInput name="city" [(ngModel)]="driverData.address.city" 
               [required]="manualAddressInput || addressSuggestions.length === 0" 
               maxlength="100">
      </mat-form-field>

      <!-- Loading and Error States -->
      <div *ngIf="isLoadingAddress" class="loading-state">
        <mat-spinner diameter="20"></mat-spinner>
        <span>A buscar morada...</span>
      </div>
      <mat-error *ngIf="addressError">{{ addressError }}</mat-error>

  
        <!-- Driver Specific Section -->
        <h3 class="section-title">Documentos</h3>
        
        <!-- License Number -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Carta de Condução</mat-label>
          <input matInput name="licenseNumber" ngModel required 
                 pattern="[A-Z0-9]{6,12}" 
                 placeholder="6-12 caracteres alfanuméricos">
        </mat-form-field>
  
        <!-- Submit Button -->
        <button mat-raised-button color="primary" type="submit" class="submit-button" [disabled]="form.invalid">
          Registar Condutor
        </button>
      </form>
    </mat-card-content>
  </mat-card>